# Collector

**Collector** — это современный веб-сервис для организации и систематизации личных коллекций монет, банкнот, марок и открыток. Приложение построено на классической архитектуре **MVC** с дополнительным сервисным слоем и предоставляет удобный интерфейс для учета редких предметов, управления их характеристиками и визуализации собраний.

Проект демонстрирует применение многоуровневой архитектуры на PHP, работу с встраиваемыми базами данных (SQLite) и реализацию надежной системы аутентификации с подтверждением через email.

## Особенности

*   **Мультиколлекционность:** Поддержка четырех типов предметов (монеты, банкноты, марки, открытки) в рамках одной системы.
*   **Детальный учет:** Каждому предмету можно задать специфические атрибуты: номинал, год выпуска, тираж, материал, серию, редкость, страну, тип, тему (для марок и открыток) и многое другое.
*   **Визуальная документация:** Возможность загрузки изображений аверса и реверса для каждого экспоната с автоматической обработкой и хранением.
*   **Гибкий поиск и фильтрация:** Поиск по названиям и кодам, а также сортировка по году выпуска, названию и другим параметрам.
*   **Система справочников:** Динамическое управление категориями (страны, типы, материалы, валюты, серии, редкость, темы, издатели) прямо из интерфейса.
*   **Безопасность:** Полноценная авторизация, восстановление пароля и смена email с подтверждением.

## Архитектура проекта

Приложение следует классической архитектуре **MVC** с дополнительным сервисным слоем:

*   **Model (Модель):** Работа с данными (SQLite), валидация и бизнес-правила.
*   **View (Представление):** Генерация HTML-разметки на основе шаблонов PHP.
*   **Controller (Контроллер):** Обработка HTTP-запросов, координация моделей и сервисов.
*   **Service (Сервис):** Инкапсуляция сложной бизнес-логики (например, работа с изображениями, отправка почты, управление коллекциями).

## Структура проекта

```text
├── config/         # Конфигурационные файлы (БД, Email)
├── database/       # Файлы базы данных SQLite
├── logs/           # Логи приложения (в т.ч. тестовые письма)
├── public/         # Точка входа (index.php), статика (CSS, изображения) и загрузки (uploads)
├── src/            # Основной исходный код
│   ├── Controller/ # Контроллеры по типам сущностей
│   ├── Model/      # Модели данных
│   ├── Service/    # Сервисы с бизнес-логикой
│   └── View/       # Шаблоны страниц (представления)
├── composer.json   # Зависимости проекта
└── create_db.php   # Скрипт инициализации БД
```

## Установка и развертывание

### Требования к системе

*   **PHP:** 8.2.28 или выше
*   **SQLite:** 3.40.1 или выше
*   **Composer:** 2.5.5 или выше
*   **Apache:** 2.4.62 или выше (с модулем `rewrite`)

#### Установка необходимых пакетов

**Для Debian/Ubuntu-подобных систем:**
```bash
sudo apt update
sudo apt install apache2 php libapache2-mod-php sqlite3 php-sqlite3 composer
```

**Для Arch Linux/Manjaro:**
```bash
sudo pacman -S apache php php-apache sqlite composer
```

**Для Fedora/RHEL-подобных систем:**
```bash
sudo dnf install httpd php php-sqlite3 sqlite composer # или yum
```

### Шаги по установке

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/Bolotnik-ss/Collector.git
    cd Collector
    ```
2.  **Установите зависимости через Composer:**
    ```bash
    composer install
    ```
3.  **Инициализируйте базу данных:**
    ```bash
    php create_db.php
    ```

### Конфигурация email (`config/email.php`)

Приложение поддерживает два режима работы email-сервиса, которые переключаются параметром `'mode' => 'test'|'production'`.

#### Тестовый режим (`'test'`)
Используется для разработки. Письма не отправляются, а сохраняются в виде логов в директории `logs/emails`.
```php
'test' => [
    'log_path' => __DIR__ . '/../logs/emails',
    'site_url' => 'http://localhost:8000'
]
```

#### Производственный режим (`'production'`)
Используется для реальной отправки писем через SMTP.
```php
'production' => [
    'smtp_host' => 'smtp.example.com',
    'smtp_secure' => PHPMailer::ENCRYPTION_SMTPS,
    'smtp_port' => 465,
    'smtp_username' => 'user@example.com',
    'smtp_password' => 'your_password_here',
    'from_email' => 'noreply@example.com',
    'from_name' => 'Collection App',
    'site_url' => 'http://collection-app.local'
]
    ```
### Запуск приложения

#### Вариант 1: Встроенный PHP-сервер (для разработки)
Запустите команду из корневой директории проекта:
```bash
php -S localhost:8000 -t public
```
Приложение будет доступно по адресу `http://localhost:8000`. В этом режиме убедитесь, что в `config/email.php` установлен `mode => 'test'`.

#### Вариант 2: Apache (производственная сборка)

1.  **Копирование проекта:**
    ```bash
    sudo cp -r /путь/к/проекту /var/www/html/collection-app
    sudo chown -R www-data:www-data /var/www/html/collection-app
    sudo chmod -R 755 /var/www/html/collection-app
    ```

2.  **Создание виртуального хоста:**
    Создайте файл `/etc/apache2/sites-available/collection-app.conf`:
    ```apache
    <VirtualHost *:80>
        ServerAdmin webmaster@localhost
        DocumentRoot /var/www/html/collection-app/public
        ServerName collection-app.local

        <Directory /var/www/html/collection-app/public>
            Options Indexes FollowSymLinks
            AllowOverride All
            Require all granted
        </Directory>

        ErrorLog ${APACHE_LOG_DIR}/collection-app_error.log
        CustomLog ${APACHE_LOG_DIR}/collection-app_access.log combined
    </VirtualHost>
    ```

3.  **Настройка домена:**
    Добавьте в `/etc/hosts`:
    ```
    127.0.0.1 collection-app.local
    ```

4.  **Активация и перезапуск:**
    ```bash
    sudo a2enmod rewrite
    sudo a2ensite collection-app.conf
    sudo systemctl restart apache2
    ```
    Приложение будет доступно по адресу `http://collection-app.local`. Не забудьте переключить `mode => 'production'` в конфиге.

## Использование

1.  **Регистрация:** Создайте аккаунт, указав логин, email, имя пользователя и пароль. После регистрации подтвердите свой email, перейдя по ссылке из письма (в тестовом режиме письма сохраняются в `logs/emails/`).
2.  **Вход в систему:** Используйте ваш логин или email и пароль. При первом входе с неподтвержденным email будет отправлено новое письмо с подтверждением.
3.  **Управление профилем:** После входа перейдите в профиль для изменения личных данных, аватара, email (с подтверждением) и пароля.
4.  **Создание коллекции:** В главном меню выберите тип коллекции (монеты, банкноты, марки, открытки), затем нажмите «Создать коллекцию» и введите название и описание.
5.  **Добавление предметов:** Откройте коллекцию и нажмите «Добавить [тип предмета]». Заполните все доступные характеристики предмета, включая страну, год, номинал, материал и загрузите изображения аверса/реверса. Используйте модальные окна для добавления новых значений в справочники (например, если нужной страны нет в списке).
6.  **Поиск и фильтрация:** На странице коллекции используйте форму поиска по названию предмета и выпадающий список для сортировки результатов.
7.  **Управление аккаунтом:** Вы можете удалить свой аккаунт через профиль, введя слово "УДАЛИТЬ" для подтверждения.

## Лицензия

Этот проект распространяется под лицензией MIT. Подробности см. в файле [LICENSE](LICENSE).

---
*Проект разработан в качестве примера реализации масштабируемых веб-приложений на PHP с использованием многослойной архитектуры.*
